/*
   lunes, 27 de abril de 202009:51:23
   User: Erik
   Server: PROGRAX\SQLEXPRESS
   Database: MPOS2
   Application: 
*/

/* To prevent any potential data loss issues, you should review this script in detail before running it outside the context of the database designer.*/
BEGIN TRANSACTION
SET QUOTED_IDENTIFIER ON
SET ARITHABORT ON
SET NUMERIC_ROUNDABORT OFF
SET CONCAT_NULL_YIELDS_NULL ON
SET ANSI_NULLS ON
SET ANSI_PADDING ON
SET ANSI_WARNINGS ON
COMMIT
BEGIN TRANSACTION
GO
ALTER TABLE dbo.P_CLIENTE
	DROP CONSTRAINT FK_P_CLIENTE_P_NIVELPRECIO
GO
ALTER TABLE dbo.P_NIVELPRECIO SET (LOCK_ESCALATION = TABLE)
GO
COMMIT
select Has_Perms_By_Name(N'dbo.P_NIVELPRECIO', 'Object', 'ALTER') as ALT_Per, Has_Perms_By_Name(N'dbo.P_NIVELPRECIO', 'Object', 'VIEW DEFINITION') as View_def_Per, Has_Perms_By_Name(N'dbo.P_NIVELPRECIO', 'Object', 'CONTROL') as Contr_Per BEGIN TRANSACTION
GO
ALTER TABLE dbo.P_CLIENTE
	DROP CONSTRAINT FK_P_CLIENTE_P_EMPRESA
GO
ALTER TABLE dbo.P_EMPRESA SET (LOCK_ESCALATION = TABLE)
GO
COMMIT
select Has_Perms_By_Name(N'dbo.P_EMPRESA', 'Object', 'ALTER') as ALT_Per, Has_Perms_By_Name(N'dbo.P_EMPRESA', 'Object', 'VIEW DEFINITION') as View_def_Per, Has_Perms_By_Name(N'dbo.P_EMPRESA', 'Object', 'CONTROL') as Contr_Per BEGIN TRANSACTION
GO
ALTER TABLE dbo.P_CLIENTE
	DROP CONSTRAINT FK_P_CLIENTE_P_MEDIAPAGO
GO
ALTER TABLE dbo.P_MEDIAPAGO SET (LOCK_ESCALATION = TABLE)
GO
COMMIT
select Has_Perms_By_Name(N'dbo.P_MEDIAPAGO', 'Object', 'ALTER') as ALT_Per, Has_Perms_By_Name(N'dbo.P_MEDIAPAGO', 'Object', 'VIEW DEFINITION') as View_def_Per, Has_Perms_By_Name(N'dbo.P_MEDIAPAGO', 'Object', 'CONTROL') as Contr_Per BEGIN TRANSACTION
GO
ALTER TABLE dbo.P_CLIENTE
	DROP CONSTRAINT DF_P_CLIENTE_NOMBRE
GO
ALTER TABLE dbo.P_CLIENTE
	DROP CONSTRAINT DF_P_CLIENTE_BLOQUEADO
GO
ALTER TABLE dbo.P_CLIENTE
	DROP CONSTRAINT DF_P_CLIENTE_ULTVISITA
GO
ALTER TABLE dbo.P_CLIENTE
	DROP CONSTRAINT DF_P_CLIENTE_IMPSPEC
GO
ALTER TABLE dbo.P_CLIENTE
	DROP CONSTRAINT DF_P_CLIENTE_NIT
GO
ALTER TABLE dbo.P_CLIENTE
	DROP CONSTRAINT DF_P_CLIENTE_EMAIL
GO
ALTER TABLE dbo.P_CLIENTE
	DROP CONSTRAINT DF_P_CLIENTE_ESERVICE
GO
ALTER TABLE dbo.P_CLIENTE
	DROP CONSTRAINT DF_P_CLIENTE_TELEFONO
GO
ALTER TABLE dbo.P_CLIENTE
	DROP CONSTRAINT DF_P_CLIENTE_COORX
GO
ALTER TABLE dbo.P_CLIENTE
	DROP CONSTRAINT DF_P_CLIENTE_COORY
GO
ALTER TABLE dbo.P_CLIENTE
	DROP CONSTRAINT DF_P_CLIENTE_BODEGA
GO
ALTER TABLE dbo.P_CLIENTE
	DROP CONSTRAINT DF__P_CLIENTE__PERCE__181857E1
GO
ALTER TABLE dbo.P_CLIENTE
	DROP CONSTRAINT DF__P_CLIENTE__TIPO___190C7C1A
GO
CREATE TABLE dbo.Tmp_P_CLIENTE
	(
	CODIGO_CLIENTE int NOT NULL,
	CODIGO nvarchar(15) NOT NULL,
	EMPRESA int NOT NULL,
	NOMBRE nvarchar(50) NULL,
	BLOQUEADO nvarchar(1) NULL,
	NIVELPRECIO int NULL,
	MEDIAPAGO int NULL,
	LIMITECREDITO float(53) NULL,
	DIACREDITO int NULL,
	DESCUENTO nvarchar(1) NULL,
	BONIFICACION nvarchar(1) NULL,
	ULTVISITA int NULL,
	IMPSPEC float(53) NULL,
	NIT nvarchar(30) NULL,
	EMAIL nvarchar(50) NULL,
	ESERVICE nvarchar(5) NULL,
	TELEFONO nvarchar(30) NULL,
	DIRECCION nvarchar(254) NULL,
	COORX float(53) NULL,
	COORY float(53) NULL,
	BODEGA nvarchar(15) NULL,
	COD_PAIS nvarchar(10) NULL,
	CODBARRA nvarchar(50) NULL,
	PERCEPCION float(53) NOT NULL,
	TIPO_CONTRIBUYENTE nvarchar(1) NOT NULL
	)  ON [PRIMARY]
GO
ALTER TABLE dbo.Tmp_P_CLIENTE SET (LOCK_ESCALATION = TABLE)
GO
ALTER TABLE dbo.Tmp_P_CLIENTE ADD CONSTRAINT
	DF_P_CLIENTE_NOMBRE DEFAULT ('') FOR NOMBRE
GO
ALTER TABLE dbo.Tmp_P_CLIENTE ADD CONSTRAINT
	DF_P_CLIENTE_BLOQUEADO DEFAULT ('N') FOR BLOQUEADO
GO
ALTER TABLE dbo.Tmp_P_CLIENTE ADD CONSTRAINT
	DF_P_CLIENTE_ULTVISITA DEFAULT (NULL) FOR ULTVISITA
GO
ALTER TABLE dbo.Tmp_P_CLIENTE ADD CONSTRAINT
	DF_P_CLIENTE_IMPSPEC DEFAULT ((0)) FOR IMPSPEC
GO
ALTER TABLE dbo.Tmp_P_CLIENTE ADD CONSTRAINT
	DF_P_CLIENTE_NIT DEFAULT ('') FOR NIT
GO
ALTER TABLE dbo.Tmp_P_CLIENTE ADD CONSTRAINT
	DF_P_CLIENTE_EMAIL DEFAULT ('') FOR EMAIL
GO
ALTER TABLE dbo.Tmp_P_CLIENTE ADD CONSTRAINT
	DF_P_CLIENTE_ESERVICE DEFAULT ('N') FOR ESERVICE
GO
ALTER TABLE dbo.Tmp_P_CLIENTE ADD CONSTRAINT
	DF_P_CLIENTE_TELEFONO DEFAULT ('') FOR TELEFONO
GO
ALTER TABLE dbo.Tmp_P_CLIENTE ADD CONSTRAINT
	DF_P_CLIENTE_COORX DEFAULT ((0)) FOR COORX
GO
ALTER TABLE dbo.Tmp_P_CLIENTE ADD CONSTRAINT
	DF_P_CLIENTE_COORY DEFAULT ((0)) FOR COORY
GO
ALTER TABLE dbo.Tmp_P_CLIENTE ADD CONSTRAINT
	DF_P_CLIENTE_BODEGA DEFAULT ('') FOR BODEGA
GO
ALTER TABLE dbo.Tmp_P_CLIENTE ADD CONSTRAINT
	DF__P_CLIENTE__PERCE__181857E1 DEFAULT ((0)) FOR PERCEPCION
GO
ALTER TABLE dbo.Tmp_P_CLIENTE ADD CONSTRAINT
	DF__P_CLIENTE__TIPO___190C7C1A DEFAULT ('') FOR TIPO_CONTRIBUYENTE
GO
IF EXISTS(SELECT * FROM dbo.P_CLIENTE)
	 EXEC('INSERT INTO dbo.Tmp_P_CLIENTE (CODIGO_CLIENTE, CODIGO, EMPRESA, NOMBRE, BLOQUEADO, NIVELPRECIO, MEDIAPAGO, LIMITECREDITO, DIACREDITO, DESCUENTO, BONIFICACION, ULTVISITA, IMPSPEC, NIT, EMAIL, ESERVICE, TELEFONO, DIRECCION, COORX, COORY, BODEGA, COD_PAIS, CODBARRA, PERCEPCION, TIPO_CONTRIBUYENTE)
		SELECT CODIGO_CLIENTE, CODIGO, EMPRESA, NOMBRE, BLOQUEADO, NIVELPRECIO, MEDIAPAGO, LIMITECREDITO, DIACREDITO, DESCUENTO, BONIFICACION, ULTVISITA, IMPSPEC, NIT, EMAIL, ESERVICE, TELEFONO, DIRECCION, COORX, COORY, BODEGA, COD_PAIS, CODBARRA, PERCEPCION, TIPO_CONTRIBUYENTE FROM dbo.P_CLIENTE WITH (HOLDLOCK TABLOCKX)')
GO
DROP TABLE dbo.P_CLIENTE
GO
EXECUTE sp_rename N'dbo.Tmp_P_CLIENTE', N'P_CLIENTE', 'OBJECT' 
GO
ALTER TABLE dbo.P_CLIENTE ADD CONSTRAINT
	PK_P_CLIENTE PRIMARY KEY CLUSTERED 
	(
	CODIGO_CLIENTE
	) WITH( STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]

GO
ALTER TABLE dbo.P_CLIENTE ADD CONSTRAINT
	FK_P_CLIENTE_P_MEDIAPAGO FOREIGN KEY
	(
	MEDIAPAGO
	) REFERENCES dbo.P_MEDIAPAGO
	(
	CODIGO
	) ON UPDATE  NO ACTION 
	 ON DELETE  NO ACTION 
	
GO
ALTER TABLE dbo.P_CLIENTE ADD CONSTRAINT
	FK_P_CLIENTE_P_EMPRESA FOREIGN KEY
	(
	EMPRESA
	) REFERENCES dbo.P_EMPRESA
	(
	EMPRESA
	) ON UPDATE  NO ACTION 
	 ON DELETE  NO ACTION 
	
GO
ALTER TABLE dbo.P_CLIENTE ADD CONSTRAINT
	FK_P_CLIENTE_P_NIVELPRECIO FOREIGN KEY
	(
	NIVELPRECIO
	) REFERENCES dbo.P_NIVELPRECIO
	(
	CODIGO
	) ON UPDATE  NO ACTION 
	 ON DELETE  NO ACTION 
	
GO
COMMIT
select Has_Perms_By_Name(N'dbo.P_CLIENTE', 'Object', 'ALTER') as ALT_Per, Has_Perms_By_Name(N'dbo.P_CLIENTE', 'Object', 'VIEW DEFINITION') as View_def_Per, Has_Perms_By_Name(N'dbo.P_CLIENTE', 'Object', 'CONTROL') as Contr_Per 
